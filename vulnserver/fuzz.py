from boofuzz import *

connection = SocketConnection("192.168.241.128", 9999, proto='tcp')
target = Target(connection=connection)
session = Session(target=target)

#cmds = ["STATS", "RTIME", "LTIME", "SRUN", "TRUN", "GMON", "GDOG", "KSTET", "GTER", "HTER", "LTER", "KSTAN"]

cmds = ["GMON"]

def check_help(target, logger, *args, **kwargs):
    msg = "Valid Commands:"
    try:
        if msg in target.recv(10000):
            return True
    except:
        print("unable to retrieve help text")
    return False

for cmd in cmds:
	s_initialize(cmd)
	s_string(cmd, fuzzable=False)
	s_delim(" ", fuzzable=False)
	s_string("FUZZ")
	s_static("\r\n")
        s_initialize('HELP') # check crash
        s_string("HELP", fuzzable=False)
	s_static("\r\n")
	session.connect(s_get(cmd))
	session.connect(s_get(cmd), s_get("HELP"), callback=check_help)

session.fuzz()
